const Discord = require("discord.js");
const ms = require("ms");
const chalk = require("chalk");
const config = require("../../config");
const sql = require("../../utilities/database");
const StateManager = require("../../utilities/state_manager");
const Timeout = new Map();
const guildPrefix = new Map();

module.exports = async (client, message) => {
 try {
  client.guilds.cache.forEach(guild => {
    const sqlquery = `SELECT guild_prefix FROM guilds WHERE guildId = '${guild.id}'`;
    sql.query(sqlquery, function (error, results, fields) {
    if (results[0]) {
        const guildId = guild.id;
        const prefix = results[0].guild_prefix;
        guildPrefix.set(guild.id, prefix);
        StateManager.emit('PrefixFetched', guildId, prefix);
        // console.log(chalk.bold(chalk.blue.bold("[RABBIT]")) + chalk.cyan.bold(`Gotten Guild Prefix. Ready: `) + chalk.blue.bold.underline(guild.name) + chalk.cyan.bold(" (ID: ") + chalk.blue.bold.underline(guild.id));
      }
    })
  });
  if (!message) return;
  if (message.author.bot) return;
  if (!message.guild) return;

  /// Ensure Music Blues Settings
  client.custom.ensure(message.guild.id, { playlists: [] });
  client.custom2.ensure(message.author.id, { myplaylists: [] });
  client.infos.ensure("global", { songs: 0, filters: 0 })
  client.settings.ensure(message.guild.id, { djroles: [], playingembed: "", playingchannel: "", botchannel: [] });
 /// Ensure Music Blues Settings End
  const prefix = guildPrefix.get(message.guild.id);
  if (message.content === `<@${client.user.id}>` || message.content === `<@!${client.user.id}>`) {
  const youcalled = new Discord.MessageEmbed()
  .setColor("#ff7900")
  .setTitle(":rabbit: YOU CALLED MR.MASATAMI")
  .setDescription(`
  <:rabbitbullet:887617523925778443> My prefix in this server is \`${prefix}\`
  <:rabbitbullet:887617523925778443> To see all  my commands please type \`${prefix}help\`
  `)
  return message.lineReply(youcalled);
  }

  if (message.content.toLowerCase().includes("rabbit")) {
    await message.react("🐰");
    await message.react("👀");
  }

  // Let's Prevent things from crashinig
  let a = sql.query("SELECT `guildId` FROM `guilds` WHERE `guildId` = ?;", message.guild.id, function (err, result, fields) {
    if(result == 0) {
      const sql1 = "INSERT INTO `guilds` (`guildId`, `guild_prefix`, `rules`, `embed_channel`, `embed_color`, `proverbs`) VALUES (" + message.guild.id + ", 'r!', '0', '0', '0', '12345678');";
      sql.query(sql1, function (error, results, fields) {if (error) console.log(error);});
    } else {
      return;
    }
  });

  let e = sql.query("SELECT `guildId` FROM `economy_ward` WHERE `guildId` = ?;", message.guild.id, function (err, result, fields) {
    if(result == 0) {
      const sql7 = "INSERT INTO `economy_ward` (`guildId`, `channelid`, `enabled`) VALUES (" + message.guild.id + ", '0', '12345678');";
      sql.query(sql7, function (error, results, fields) {if (error) console.log(error);});
    } else {
      return;
    }
  });
  let f = sql.query("SELECT `guildId` FROM `boosters` WHERE `guildId` = ?;", message.guild.id, function (err, result, fields) {
    if(result == 0) {
      const sql8 = "INSERT INTO `boosters` (`guildId`, `channelid`, `enabled`) VALUES (" + message.guild.id + ", '0', '12345678');";
      sql.query(sql8, function (error, results, fields) {if (error) console.log(error);});
    } else {
      return;
    }
  });
  // Proverb Settings
  if (message.content.toLowerCase().includes("do you know")) {
  let con = sql.query("SELECT proverbs AS res FROM guilds WHERE guildid = " + message.guild.id, function (error, results, fields) {
  if (error) console.log(error);
  const logsetup = results[0].res;
  const log = message.guild.channels.cache.find((c) => c.id == logsetup && c.type == "text");
  if (!message.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  if (!log) return;
  if (!log.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  message.guild.fetchAuditLogs().then((logs) => { 
  const vab = ["<:xquestion:888362040647909406> Have bread is better than none", "<:xquestion:888362040647909406> An apple a day keeps the doctor away", "<:xquestion:888362040647909406> It's better to be safe than sorry", "<:xquestion:888362040647909406> Actions speak louder than words", "<:xquestion:888362040647909406> You catch more flies with honey than with vinegar", "<:xquestion:888362040647909406> Women are the greatest source of troble", "<:xquestion:888362040647909406> You should not judge a book by its cover.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness", "<:xquestion:888362040647909406> The early bird catches the worm", "<:xquestion:888362040647909406> It's good to strike while the iron is hot", "<:xquestion:888362040647909406> You can't have your cake and eat it too.", "<:xquestion:888362040647909406> Many hands make light work", "<:xquestion:888362040647909406> When you're in Rome, do as the Romans do", "<:xquestion:888362040647909406> All That Glitters is Not Gold", "<:xquestion:888362040647909406> A Journey of Thousand Miles\nBegins with a Single Step", "<:xquestion:888362040647909406> Pride goeth before a fall", "<:xquestion:888362040647909406> A bad workman always blames his tools", "<:xquestion:888362040647909406> A bird in hand is worth two in the bush.", "<:xquestion:888362040647909406> Absence makes the heart grow fonder", "<:xquestion:888362040647909406> A chain is only as strong as its weakest link", "<:xquestion:888362040647909406> A drowning man will clutch at a straw", "<:xquestion:888362040647909406> Adversity and loss make a man wise", "<:xquestion:888362040647909406> More haste, less speed", "<:xquestion:888362040647909406> No news is good news", "<:xquestion:888362040647909406> Once bitten, twice shy", "<:xquestion:888362040647909406> A leopard cannot change from its spots.", "<:xquestion:888362040647909406> All good things come to an end.", "<:xquestion:888362040647909406> All’s fair in love and war.", "<:xquestion:888362040647909406> Always put your best foot forward.", "<:xquestion:888362040647909406> Among the blind the one-eyed man is king.", "<:xquestion:888362040647909406> An empty vessel makes much noise.", "<:xquestion:888362040647909406> An idle brain is the devil’s workshop.", "<:xquestion:888362040647909406> An ounce of protection is worth a pound of cure.", "<:xquestion:888362040647909406> A picture is worth a thousand words.", "<:xquestion:888362040647909406>  Appearances can be deceptive.", "<:xquestion:888362040647909406> A rolling stone gathers no moss.", "<:xquestion:888362040647909406> A ship in the harbor is safe\nBut that is not what a ship is for.", "<:xquestion:888362040647909406> A stitch in time saves nine.", "<:xquestion:888362040647909406> As you sow, so you shall reap.", "<:xquestion:888362040647909406> A thing begun is half done.", "<:xquestion:888362040647909406> Barking dogs seldom bite.", "<:xquestion:888362040647909406>  Be slow in choosing, but slower in changing.", "<:xquestion:888362040647909406> Beauty is in the eye of the beholder.", "<:xquestion:888362040647909406> Beauty is only skin deep.", "<:xquestion:888362040647909406> Beggars can’t be choosers.", "<:xquestion:888362040647909406> Best things in life are free.", "<:xquestion:888362040647909406>  Better late than never.", "<:xquestion:888362040647909406> Better to be poor and healthy\nRather than rich and sick.", "<:xquestion:888362040647909406> Better to wear out than to rust out.", "<:xquestion:888362040647909406> Blood is thicker than water.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness.", "<:xquestion:888362040647909406> Clothes do not make the man.", "<:xquestion:888362040647909406> Cowards die many times before their deaths.", "<:xquestion:888362040647909406> Cross the stream where it is shallowest.", "<:xquestion:888362040647909406> Curiosity killed the cat.", "<:xquestion:888362040647909406> Curses, like chickens, come home to roost.", "<:xquestion:888362040647909406>  Discretion is the better part of valor.", "<:xquestion:888362040647909406> Don’t bite off more than you can chew.", "<:xquestion:888362040647909406> Don’t bite the hand that feeds you.", "<:xquestion:888362040647909406> Don’t blow your own trumpet.", "<:xquestion:888362040647909406> Don’t cast pearls before swine.", "<:xquestion:888362040647909406> If men could read minds\nThe world would have ended long ago", "<:xquestion:888362040647909406> Don’t count your chickens before they hatch.", "<:xquestion:888362040647909406> Don’t cross a bridge until you come to it.", "<:xquestion:888362040647909406> Don’t kill the goose that lays the golden eggs.", "<:xquestion:888362040647909406> Don’t put all your eggs in one basket", "<:xquestion:888362040647909406> Don’t put the cart before the horse.", "<:xquestion:888362040647909406> Don’t throw the baby with the bathwater.", "<:xquestion:888362040647909406> Easy come, easy go.", "<:xquestion:888362040647909406> Empty bags cannot stand upright.", "<:xquestion:888362040647909406> Every cloud has a silver lining.", "<:xquestion:888362040647909406> Every dog has his day.", "<:xquestion:888362040647909406> Every man is the architect of his destiny.", "<:xquestion:888362040647909406> Every man has his price.", "<:xquestion:888362040647909406> Fall seven times. Stand up eight.", "<:xquestion:888362040647909406> Fortune favors the brave.", "<:xquestion:888362040647909406> **God** helps those who help themselves.", "<:xquestion:888362040647909406> Give them an inch and they’ll take a mile.", "<:xquestion:888362040647909406> Good things come to those who wait.", "<:xquestion:888362040647909406> Grief divided is made lighter.", "<:xquestion:888362040647909406> Honesty is the best policy.", "<:xquestion:888362040647909406> Hope for the best, prepare for the worst", "<:xquestion:888362040647909406> If it ain’t broke, don’t fix it.", "<:xquestion:888362040647909406> If the mountain won’t come to Muhammad\nMuhammad must go to the mountain.", "<:xquestion:888362040647909406> If you play with fire, you’ll get burned.", "<:xquestion:888362040647909406> Ignorance is bliss.", "<:xquestion:888362040647909406> It’s better to be safe than sorry.", "<:xquestion:888362040647909406> It’s never too late to mend.", "<:xquestion:888362040647909406> It’s not over till it’s over.", "<:xquestion:888362040647909406> It’s no use crying over spilt milk.", "<:xquestion:888362040647909406> It takes two to make a quarrel.", "<:xquestion:888362040647909406> Keep your mouth shut and your eyes open.", "<:xquestion:888362040647909406> Laughter is the best medicine.", "<:xquestion:888362040647909406> Learn to walk before you run.", "<:xquestion:888362040647909406> Life begins at forty.", "<:xquestion:888362040647909406> Let sleeping dogs lie.", "<:xquestion:888362040647909406> Lightning never strikes twice in the same place.", "<:xquestion:888362040647909406> Look before you leap.", "<:xquestion:888362040647909406> Make hay while the sun shines.", "<:xquestion:888362040647909406> Money doesn’t grow on trees.", "<:xquestion:888362040647909406> Money talks.", "<:xquestion:888362040647909406> Necessity is the mother of invention.", "<:xquestion:888362040647909406> Never put off until tomorrow what you can do today.", "<:xquestion:888362040647909406> Never test the depth of water with both feet.", "<:xquestion:888362040647909406> No gain without pain.", "<:xquestion:888362040647909406> Once bitten twice shy.", "<:xquestion:888362040647909406> One man’s junk is another man’s treasure.", "<:xquestion:888362040647909406> One shouldn’t miss forest for the trees.", "<:xquestion:888362040647909406> Out of sight, out of mind.", "<:xquestion:888362040647909406> Pen is mightier than sword.", "<:xquestion:888362040647909406> People who live in glass houses\n shouldn’t throw stones at others.", "<:xquestion:888362040647909406> Persuasion is better than force.", "<:xquestion:888362040647909406>  Practice makes perfect.", "<:xquestion:888362040647909406> Practice what you preach.", "<:xquestion:888362040647909406> Rome was not built in a day."];
  randomProverbs = vab[Math.floor(Math.random() * vab.length)];
  log.send(randomProverbs);
  });
  });
  }

  if (message.content.toLowerCase().includes("do you know that")) {
  let con = sql.query("SELECT proverbs AS res FROM guilds WHERE guildid = " + message.guild.id, function (error, results, fields) {
  if (error) console.log(error);
  const logsetup = results[0].res;
  const log = message.guild.channels.cache.find((c) => c.id == logsetup && c.type == "text");
  if (!message.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  if (!log) return;
  if (!log.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  message.guild.fetchAuditLogs().then((logs) => { 
  const vab = ["<:xquestion:888362040647909406> Have bread is better than none", "<:xquestion:888362040647909406> An apple a day keeps the doctor away", "<:xquestion:888362040647909406> It's better to be safe than sorry", "<:xquestion:888362040647909406> Actions speak louder than words", "<:xquestion:888362040647909406> You catch more flies with honey than with vinegar", "<:xquestion:888362040647909406> Women are the greatest source of troble", "<:xquestion:888362040647909406> You should not judge a book by its cover.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness", "<:xquestion:888362040647909406> The early bird catches the worm", "<:xquestion:888362040647909406> It's good to strike while the iron is hot", "<:xquestion:888362040647909406> You can't have your cake and eat it too.", "<:xquestion:888362040647909406> Many hands make light work", "<:xquestion:888362040647909406> When you're in Rome, do as the Romans do", "<:xquestion:888362040647909406> All That Glitters is Not Gold", "<:xquestion:888362040647909406> A Journey of Thousand Miles\nBegins with a Single Step", "<:xquestion:888362040647909406> Pride goeth before a fall", "<:xquestion:888362040647909406> A bad workman always blames his tools", "<:xquestion:888362040647909406> A bird in hand is worth two in the bush.", "<:xquestion:888362040647909406> Absence makes the heart grow fonder", "<:xquestion:888362040647909406> A chain is only as strong as its weakest link", "<:xquestion:888362040647909406> A drowning man will clutch at a straw", "<:xquestion:888362040647909406> Adversity and loss make a man wise", "<:xquestion:888362040647909406> More haste, less speed", "<:xquestion:888362040647909406> No news is good news", "<:xquestion:888362040647909406> Once bitten, twice shy", "<:xquestion:888362040647909406> A leopard cannot change from its spots.", "<:xquestion:888362040647909406> All good things come to an end.", "<:xquestion:888362040647909406> All’s fair in love and war.", "<:xquestion:888362040647909406> Always put your best foot forward.", "<:xquestion:888362040647909406> Among the blind the one-eyed man is king.", "<:xquestion:888362040647909406> An empty vessel makes much noise.", "<:xquestion:888362040647909406> An idle brain is the devil’s workshop.", "<:xquestion:888362040647909406> An ounce of protection is worth a pound of cure.", "<:xquestion:888362040647909406> A picture is worth a thousand words.", "<:xquestion:888362040647909406>  Appearances can be deceptive.", "<:xquestion:888362040647909406> A rolling stone gathers no moss.", "<:xquestion:888362040647909406> A ship in the harbor is safe\nBut that is not what a ship is for.", "<:xquestion:888362040647909406> A stitch in time saves nine.", "<:xquestion:888362040647909406> As you sow, so you shall reap.", "<:xquestion:888362040647909406> A thing begun is half done.", "<:xquestion:888362040647909406> Barking dogs seldom bite.", "<:xquestion:888362040647909406>  Be slow in choosing, but slower in changing.", "<:xquestion:888362040647909406> Beauty is in the eye of the beholder.", "<:xquestion:888362040647909406> Beauty is only skin deep.", "<:xquestion:888362040647909406> Beggars can’t be choosers.", "<:xquestion:888362040647909406> Best things in life are free.", "<:xquestion:888362040647909406>  Better late than never.", "<:xquestion:888362040647909406> Better to be poor and healthy\nRather than rich and sick.", "<:xquestion:888362040647909406> Better to wear out than to rust out.", "<:xquestion:888362040647909406> Blood is thicker than water.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness.", "<:xquestion:888362040647909406> Clothes do not make the man.", "<:xquestion:888362040647909406> Cowards die many times before their deaths.", "<:xquestion:888362040647909406> Cross the stream where it is shallowest.", "<:xquestion:888362040647909406> Curiosity killed the cat.", "<:xquestion:888362040647909406> Curses, like chickens, come home to roost.", "<:xquestion:888362040647909406>  Discretion is the better part of valor.", "<:xquestion:888362040647909406> Don’t bite off more than you can chew.", "<:xquestion:888362040647909406> Don’t bite the hand that feeds you.", "<:xquestion:888362040647909406> Don’t blow your own trumpet.", "<:xquestion:888362040647909406> Don’t cast pearls before swine.", "<:xquestion:888362040647909406> If men could read minds\nThe world would have ended long ago", "<:xquestion:888362040647909406> Don’t count your chickens before they hatch.", "<:xquestion:888362040647909406> Don’t cross a bridge until you come to it.", "<:xquestion:888362040647909406> Don’t kill the goose that lays the golden eggs.", "<:xquestion:888362040647909406> Don’t put all your eggs in one basket", "<:xquestion:888362040647909406> Don’t put the cart before the horse.", "<:xquestion:888362040647909406> Don’t throw the baby with the bathwater.", "<:xquestion:888362040647909406> Easy come, easy go.", "<:xquestion:888362040647909406> Empty bags cannot stand upright.", "<:xquestion:888362040647909406> Every cloud has a silver lining.", "<:xquestion:888362040647909406> Every dog has his day.", "<:xquestion:888362040647909406> Every man is the architect of his destiny.", "<:xquestion:888362040647909406> Every man has his price.", "<:xquestion:888362040647909406> Fall seven times. Stand up eight.", "<:xquestion:888362040647909406> Fortune favors the brave.", "<:xquestion:888362040647909406> **God** helps those who help themselves.", "<:xquestion:888362040647909406> Give them an inch and they’ll take a mile.", "<:xquestion:888362040647909406> Good things come to those who wait.", "<:xquestion:888362040647909406> Grief divided is made lighter.", "<:xquestion:888362040647909406> Honesty is the best policy.", "<:xquestion:888362040647909406> Hope for the best, prepare for the worst", "<:xquestion:888362040647909406> If it ain’t broke, don’t fix it.", "<:xquestion:888362040647909406> If the mountain won’t come to Muhammad\nMuhammad must go to the mountain.", "<:xquestion:888362040647909406> If you play with fire, you’ll get burned.", "<:xquestion:888362040647909406> Ignorance is bliss.", "<:xquestion:888362040647909406> It’s better to be safe than sorry.", "<:xquestion:888362040647909406> It’s never too late to mend.", "<:xquestion:888362040647909406> It’s not over till it’s over.", "<:xquestion:888362040647909406> It’s no use crying over spilt milk.", "<:xquestion:888362040647909406> It takes two to make a quarrel.", "<:xquestion:888362040647909406> Keep your mouth shut and your eyes open.", "<:xquestion:888362040647909406> Laughter is the best medicine.", "<:xquestion:888362040647909406> Learn to walk before you run.", "<:xquestion:888362040647909406> Life begins at forty.", "<:xquestion:888362040647909406> Let sleeping dogs lie.", "<:xquestion:888362040647909406> Lightning never strikes twice in the same place.", "<:xquestion:888362040647909406> Look before you leap.", "<:xquestion:888362040647909406> Make hay while the sun shines.", "<:xquestion:888362040647909406> Money doesn’t grow on trees.", "<:xquestion:888362040647909406> Money talks.", "<:xquestion:888362040647909406> Necessity is the mother of invention.", "<:xquestion:888362040647909406> Never put off until tomorrow what you can do today.", "<:xquestion:888362040647909406> Never test the depth of water with both feet.", "<:xquestion:888362040647909406> No gain without pain.", "<:xquestion:888362040647909406> Once bitten twice shy.", "<:xquestion:888362040647909406> One man’s junk is another man’s treasure.", "<:xquestion:888362040647909406> One shouldn’t miss forest for the trees.", "<:xquestion:888362040647909406> Out of sight, out of mind.", "<:xquestion:888362040647909406> Pen is mightier than sword.", "<:xquestion:888362040647909406> People who live in glass houses\n shouldn’t throw stones at others.", "<:xquestion:888362040647909406> Persuasion is better than force.", "<:xquestion:888362040647909406>  Practice makes perfect.", "<:xquestion:888362040647909406> Practice what you preach.", "<:xquestion:888362040647909406> Rome was not built in a day."];
  randomProverbs = vab[Math.floor(Math.random() * vab.length)];
  log.send(randomProverbs);
  });
  });
  }

  if (message.content.toLowerCase().includes("proverb")) {
  let con = sql.query("SELECT proverbs AS res FROM guilds WHERE guildid = " + message.guild.id, function (error, results, fields) {
  if (error) console.log(error);
  const logsetup = results[0].res;
  const log = message.guild.channels.cache.find((c) => c.id == logsetup && c.type == "text");
  if (!message.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  if (!log) return;
  if (!log.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  message.guild.fetchAuditLogs().then((logs) => { 
  const vab = ["<:xquestion:888362040647909406> Have bread is better than none", "<:xquestion:888362040647909406> An apple a day keeps the doctor away", "<:xquestion:888362040647909406> It's better to be safe than sorry", "<:xquestion:888362040647909406> Actions speak louder than words", "<:xquestion:888362040647909406> You catch more flies with honey than with vinegar", "<:xquestion:888362040647909406> Women are the greatest source of troble", "<:xquestion:888362040647909406> You should not judge a book by its cover.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness", "<:xquestion:888362040647909406> The early bird catches the worm", "<:xquestion:888362040647909406> It's good to strike while the iron is hot", "<:xquestion:888362040647909406> You can't have your cake and eat it too.", "<:xquestion:888362040647909406> Many hands make light work", "<:xquestion:888362040647909406> When you're in Rome, do as the Romans do", "<:xquestion:888362040647909406> All That Glitters is Not Gold", "<:xquestion:888362040647909406> A Journey of Thousand Miles\nBegins with a Single Step", "<:xquestion:888362040647909406> Pride goeth before a fall", "<:xquestion:888362040647909406> A bad workman always blames his tools", "<:xquestion:888362040647909406> A bird in hand is worth two in the bush.", "<:xquestion:888362040647909406> Absence makes the heart grow fonder", "<:xquestion:888362040647909406> A chain is only as strong as its weakest link", "<:xquestion:888362040647909406> A drowning man will clutch at a straw", "<:xquestion:888362040647909406> Adversity and loss make a man wise", "<:xquestion:888362040647909406> More haste, less speed", "<:xquestion:888362040647909406> No news is good news", "<:xquestion:888362040647909406> Once bitten, twice shy", "<:xquestion:888362040647909406> A leopard cannot change from its spots.", "<:xquestion:888362040647909406> All good things come to an end.", "<:xquestion:888362040647909406> All’s fair in love and war.", "<:xquestion:888362040647909406> Always put your best foot forward.", "<:xquestion:888362040647909406> Among the blind the one-eyed man is king.", "<:xquestion:888362040647909406> An empty vessel makes much noise.", "<:xquestion:888362040647909406> An idle brain is the devil’s workshop.", "<:xquestion:888362040647909406> An ounce of protection is worth a pound of cure.", "<:xquestion:888362040647909406> A picture is worth a thousand words.", "<:xquestion:888362040647909406>  Appearances can be deceptive.", "<:xquestion:888362040647909406> A rolling stone gathers no moss.", "<:xquestion:888362040647909406> A ship in the harbor is safe\nBut that is not what a ship is for.", "<:xquestion:888362040647909406> A stitch in time saves nine.", "<:xquestion:888362040647909406> As you sow, so you shall reap.", "<:xquestion:888362040647909406> A thing begun is half done.", "<:xquestion:888362040647909406> Barking dogs seldom bite.", "<:xquestion:888362040647909406>  Be slow in choosing, but slower in changing.", "<:xquestion:888362040647909406> Beauty is in the eye of the beholder.", "<:xquestion:888362040647909406> Beauty is only skin deep.", "<:xquestion:888362040647909406> Beggars can’t be choosers.", "<:xquestion:888362040647909406> Best things in life are free.", "<:xquestion:888362040647909406>  Better late than never.", "<:xquestion:888362040647909406> Better to be poor and healthy\nRather than rich and sick.", "<:xquestion:888362040647909406> Better to wear out than to rust out.", "<:xquestion:888362040647909406> Blood is thicker than water.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness.", "<:xquestion:888362040647909406> Clothes do not make the man.", "<:xquestion:888362040647909406> Cowards die many times before their deaths.", "<:xquestion:888362040647909406> Cross the stream where it is shallowest.", "<:xquestion:888362040647909406> Curiosity killed the cat.", "<:xquestion:888362040647909406> Curses, like chickens, come home to roost.", "<:xquestion:888362040647909406>  Discretion is the better part of valor.", "<:xquestion:888362040647909406> Don’t bite off more than you can chew.", "<:xquestion:888362040647909406> Don’t bite the hand that feeds you.", "<:xquestion:888362040647909406> Don’t blow your own trumpet.", "<:xquestion:888362040647909406> Don’t cast pearls before swine.", "<:xquestion:888362040647909406> If men could read minds\nThe world would have ended long ago", "<:xquestion:888362040647909406> Don’t count your chickens before they hatch.", "<:xquestion:888362040647909406> Don’t cross a bridge until you come to it.", "<:xquestion:888362040647909406> Don’t kill the goose that lays the golden eggs.", "<:xquestion:888362040647909406> Don’t put all your eggs in one basket", "<:xquestion:888362040647909406> Don’t put the cart before the horse.", "<:xquestion:888362040647909406> Don’t throw the baby with the bathwater.", "<:xquestion:888362040647909406> Easy come, easy go.", "<:xquestion:888362040647909406> Empty bags cannot stand upright.", "<:xquestion:888362040647909406> Every cloud has a silver lining.", "<:xquestion:888362040647909406> Every dog has his day.", "<:xquestion:888362040647909406> Every man is the architect of his destiny.", "<:xquestion:888362040647909406> Every man has his price.", "<:xquestion:888362040647909406> Fall seven times. Stand up eight.", "<:xquestion:888362040647909406> Fortune favors the brave.", "<:xquestion:888362040647909406> **God** helps those who help themselves.", "<:xquestion:888362040647909406> Give them an inch and they’ll take a mile.", "<:xquestion:888362040647909406> Good things come to those who wait.", "<:xquestion:888362040647909406> Grief divided is made lighter.", "<:xquestion:888362040647909406> Honesty is the best policy.", "<:xquestion:888362040647909406> Hope for the best, prepare for the worst", "<:xquestion:888362040647909406> If it ain’t broke, don’t fix it.", "<:xquestion:888362040647909406> If the mountain won’t come to Muhammad\nMuhammad must go to the mountain.", "<:xquestion:888362040647909406> If you play with fire, you’ll get burned.", "<:xquestion:888362040647909406> Ignorance is bliss.", "<:xquestion:888362040647909406> It’s better to be safe than sorry.", "<:xquestion:888362040647909406> It’s never too late to mend.", "<:xquestion:888362040647909406> It’s not over till it’s over.", "<:xquestion:888362040647909406> It’s no use crying over spilt milk.", "<:xquestion:888362040647909406> It takes two to make a quarrel.", "<:xquestion:888362040647909406> Keep your mouth shut and your eyes open.", "<:xquestion:888362040647909406> Laughter is the best medicine.", "<:xquestion:888362040647909406> Learn to walk before you run.", "<:xquestion:888362040647909406> Life begins at forty.", "<:xquestion:888362040647909406> Let sleeping dogs lie.", "<:xquestion:888362040647909406> Lightning never strikes twice in the same place.", "<:xquestion:888362040647909406> Look before you leap.", "<:xquestion:888362040647909406> Make hay while the sun shines.", "<:xquestion:888362040647909406> Money doesn’t grow on trees.", "<:xquestion:888362040647909406> Money talks.", "<:xquestion:888362040647909406> Necessity is the mother of invention.", "<:xquestion:888362040647909406> Never put off until tomorrow what you can do today.", "<:xquestion:888362040647909406> Never test the depth of water with both feet.", "<:xquestion:888362040647909406> No gain without pain.", "<:xquestion:888362040647909406> Once bitten twice shy.", "<:xquestion:888362040647909406> One man’s junk is another man’s treasure.", "<:xquestion:888362040647909406> One shouldn’t miss forest for the trees.", "<:xquestion:888362040647909406> Out of sight, out of mind.", "<:xquestion:888362040647909406> Pen is mightier than sword.", "<:xquestion:888362040647909406> People who live in glass houses\n shouldn’t throw stones at others.", "<:xquestion:888362040647909406> Persuasion is better than force.", "<:xquestion:888362040647909406>  Practice makes perfect.", "<:xquestion:888362040647909406> Practice what you preach.", "<:xquestion:888362040647909406> Rome was not built in a day."];
  randomProverbs = vab[Math.floor(Math.random() * vab.length)];
  log.send(randomProverbs);
  });
  });
  }

  if (message.content.toLowerCase().includes("insights")) {
  let con = sql.query("SELECT proverbs AS res FROM guilds WHERE guildid = " + message.guild.id, function (error, results, fields) {
  if (error) console.log(error);
  const logsetup = results[0].res;
  const log = message.guild.channels.cache.find((c) => c.id == logsetup && c.type == "text");
  if (!message.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  if (!log) return;
  if (!log.guild.member(client.user).hasPermission("EMBED_LINKS", "VIEW_CHANNEL", "READ_MESSAGE_HISTORY", "VIEW_AUDIT_LOG", "SEND_MESSAGES")) return;
  message.guild.fetchAuditLogs().then((logs) => { 
  const vab = ["<:xquestion:888362040647909406> Have bread is better than none", "<:xquestion:888362040647909406> An apple a day keeps the doctor away", "<:xquestion:888362040647909406> It's better to be safe than sorry", "<:xquestion:888362040647909406> Actions speak louder than words", "<:xquestion:888362040647909406> You catch more flies with honey than with vinegar", "<:xquestion:888362040647909406> Women are the greatest source of troble", "<:xquestion:888362040647909406> You should not judge a book by its cover.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness", "<:xquestion:888362040647909406> The early bird catches the worm", "<:xquestion:888362040647909406> It's good to strike while the iron is hot", "<:xquestion:888362040647909406> You can't have your cake and eat it too.", "<:xquestion:888362040647909406> Many hands make light work", "<:xquestion:888362040647909406> When you're in Rome, do as the Romans do", "<:xquestion:888362040647909406> All That Glitters is Not Gold", "<:xquestion:888362040647909406> A Journey of Thousand Miles\nBegins with a Single Step", "<:xquestion:888362040647909406> Pride goeth before a fall", "<:xquestion:888362040647909406> A bad workman always blames his tools", "<:xquestion:888362040647909406> A bird in hand is worth two in the bush.", "<:xquestion:888362040647909406> Absence makes the heart grow fonder", "<:xquestion:888362040647909406> A chain is only as strong as its weakest link", "<:xquestion:888362040647909406> A drowning man will clutch at a straw", "<:xquestion:888362040647909406> Adversity and loss make a man wise", "<:xquestion:888362040647909406> More haste, less speed", "<:xquestion:888362040647909406> No news is good news", "<:xquestion:888362040647909406> Once bitten, twice shy", "<:xquestion:888362040647909406> A leopard cannot change from its spots.", "<:xquestion:888362040647909406> All good things come to an end.", "<:xquestion:888362040647909406> All’s fair in love and war.", "<:xquestion:888362040647909406> Always put your best foot forward.", "<:xquestion:888362040647909406> Among the blind the one-eyed man is king.", "<:xquestion:888362040647909406> An empty vessel makes much noise.", "<:xquestion:888362040647909406> An idle brain is the devil’s workshop.", "<:xquestion:888362040647909406> An ounce of protection is worth a pound of cure.", "<:xquestion:888362040647909406> A picture is worth a thousand words.", "<:xquestion:888362040647909406>  Appearances can be deceptive.", "<:xquestion:888362040647909406> A rolling stone gathers no moss.", "<:xquestion:888362040647909406> A ship in the harbor is safe\nBut that is not what a ship is for.", "<:xquestion:888362040647909406> A stitch in time saves nine.", "<:xquestion:888362040647909406> As you sow, so you shall reap.", "<:xquestion:888362040647909406> A thing begun is half done.", "<:xquestion:888362040647909406> Barking dogs seldom bite.", "<:xquestion:888362040647909406>  Be slow in choosing, but slower in changing.", "<:xquestion:888362040647909406> Beauty is in the eye of the beholder.", "<:xquestion:888362040647909406> Beauty is only skin deep.", "<:xquestion:888362040647909406> Beggars can’t be choosers.", "<:xquestion:888362040647909406> Best things in life are free.", "<:xquestion:888362040647909406>  Better late than never.", "<:xquestion:888362040647909406> Better to be poor and healthy\nRather than rich and sick.", "<:xquestion:888362040647909406> Better to wear out than to rust out.", "<:xquestion:888362040647909406> Blood is thicker than water.", "<:xquestion:888362040647909406> Cleanliness is next to Godliness.", "<:xquestion:888362040647909406> Clothes do not make the man.", "<:xquestion:888362040647909406> Cowards die many times before their deaths.", "<:xquestion:888362040647909406> Cross the stream where it is shallowest.", "<:xquestion:888362040647909406> Curiosity killed the cat.", "<:xquestion:888362040647909406> Curses, like chickens, come home to roost.", "<:xquestion:888362040647909406>  Discretion is the better part of valor.", "<:xquestion:888362040647909406> Don’t bite off more than you can chew.", "<:xquestion:888362040647909406> Don’t bite the hand that feeds you.", "<:xquestion:888362040647909406> Don’t blow your own trumpet.", "<:xquestion:888362040647909406> Don’t cast pearls before swine.", "<:xquestion:888362040647909406> If men could read minds\nThe world would have ended long ago", "<:xquestion:888362040647909406> Don’t count your chickens before they hatch.", "<:xquestion:888362040647909406> Don’t cross a bridge until you come to it.", "<:xquestion:888362040647909406> Don’t kill the goose that lays the golden eggs.", "<:xquestion:888362040647909406> Don’t put all your eggs in one basket", "<:xquestion:888362040647909406> Don’t put the cart before the horse.", "<:xquestion:888362040647909406> Don’t throw the baby with the bathwater.", "<:xquestion:888362040647909406> Easy come, easy go.", "<:xquestion:888362040647909406> Empty bags cannot stand upright.", "<:xquestion:888362040647909406> Every cloud has a silver lining.", "<:xquestion:888362040647909406> Every dog has his day.", "<:xquestion:888362040647909406> Every man is the architect of his destiny.", "<:xquestion:888362040647909406> Every man has his price.", "<:xquestion:888362040647909406> Fall seven times. Stand up eight.", "<:xquestion:888362040647909406> Fortune favors the brave.", "<:xquestion:888362040647909406> **God** helps those who help themselves.", "<:xquestion:888362040647909406> Give them an inch and they’ll take a mile.", "<:xquestion:888362040647909406> Good things come to those who wait.", "<:xquestion:888362040647909406> Grief divided is made lighter.", "<:xquestion:888362040647909406> Honesty is the best policy.", "<:xquestion:888362040647909406> Hope for the best, prepare for the worst", "<:xquestion:888362040647909406> If it ain’t broke, don’t fix it.", "<:xquestion:888362040647909406> If the mountain won’t come to Muhammad\nMuhammad must go to the mountain.", "<:xquestion:888362040647909406> If you play with fire, you’ll get burned.", "<:xquestion:888362040647909406> Ignorance is bliss.", "<:xquestion:888362040647909406> It’s better to be safe than sorry.", "<:xquestion:888362040647909406> It’s never too late to mend.", "<:xquestion:888362040647909406> It’s not over till it’s over.", "<:xquestion:888362040647909406> It’s no use crying over spilt milk.", "<:xquestion:888362040647909406> It takes two to make a quarrel.", "<:xquestion:888362040647909406> Keep your mouth shut and your eyes open.", "<:xquestion:888362040647909406> Laughter is the best medicine.", "<:xquestion:888362040647909406> Learn to walk before you run.", "<:xquestion:888362040647909406> Life begins at forty.", "<:xquestion:888362040647909406> Let sleeping dogs lie.", "<:xquestion:888362040647909406> Lightning never strikes twice in the same place.", "<:xquestion:888362040647909406> Look before you leap.", "<:xquestion:888362040647909406> Make hay while the sun shines.", "<:xquestion:888362040647909406> Money doesn’t grow on trees.", "<:xquestion:888362040647909406> Money talks.", "<:xquestion:888362040647909406> Necessity is the mother of invention.", "<:xquestion:888362040647909406> Never put off until tomorrow what you can do today.", "<:xquestion:888362040647909406> Never test the depth of water with both feet.", "<:xquestion:888362040647909406> No gain without pain.", "<:xquestion:888362040647909406> Once bitten twice shy.", "<:xquestion:888362040647909406> One man’s junk is another man’s treasure.", "<:xquestion:888362040647909406> One shouldn’t miss forest for the trees.", "<:xquestion:888362040647909406> Out of sight, out of mind.", "<:xquestion:888362040647909406> Pen is mightier than sword.", "<:xquestion:888362040647909406> People who live in glass houses\n shouldn’t throw stones at others.", "<:xquestion:888362040647909406> Persuasion is better than force.", "<:xquestion:888362040647909406>  Practice makes perfect.", "<:xquestion:888362040647909406> Practice what you preach.", "<:xquestion:888362040647909406> Rome was not built in a day."];
  randomProverbs = vab[Math.floor(Math.random() * vab.length)];
  log.send(randomProverbs);
  });
  });
  }

  if (!message.content.startsWith(prefix)) return;
  if (!message.member) message.member = await message.guild.fetchMember(message);
  const args = message.content.slice(prefix.length).trim().split(/ +/g);
  const cmd = args.shift().toLowerCase();
  if (cmd.length === 0) return;
  let command = client.commands.get(cmd);
  if (!command) command = client.commands.get(client.aliases.get(cmd));
  if (!command) {
   return;
  }

  if (command) {
   const timeout = command.timeout || 5000;
   const key = message.author.id + command.name;
   const found = Timeout.get(key);
   if (found) {
   const timePassed = Date.now() - found;
   const timeLeft = timeout - timePassed;
   message.channel.send(`⏰ You need to wait another **${ms(timeLeft)}**\nBefore you can use this command.`);
   } else {
    command.run(client, message, args);
    Timeout.set(key, Date.now());
    setTimeout(() => {
     Timeout.delete(key);
    }, timeout);
   }
  }
 } catch (err) {
  console.log(err);
  message.lineReply("<:errorcode:868245243357712384>**|** Oops Something went wrong. Try Running the command again later");
 }
};
StateManager.on('PrefixFetched', (guildId, prefix) => {
  guildPrefix.set(guildId, prefix);
});